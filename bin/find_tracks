#! /bin/bash

#funcs=$MUSICHOME/bin/functions
#[[ -r $funcs ]] || { echo "$0: can't load functions" >&2 && exit 1; }
#. $funcs

readonly me=${0##*/}                                                    # slightly prettier than $0

verbose=0
while getopts ":v" opt
do
    case $opt in
        v)  verbose=1
            ;;
        h)  echo "usage: $me -h | [-v] pattern [...]" >&2
            echo "    -v : verbose (display full path names [default: strip common music dirs])" >&2
            echo "    -h : this help message" >&2
            echo "    pattern : word to find in a song title (case-insensitive)" >&2
            exit
            ;;
        :)  echo "$me: $OPTARG requires an argument ($me -h for help)" >&2
            exit 2
            ;;
        \?) echo "$me: unknown argument $OPTARG ($me -h for help)" >&2
            exit 2
            ;;
    esac
done
shift $(( $OPTIND - 1 ))


IFS="
"

function get_tracks
{
	(
		for arg
		do
			find $MUSICHOME/Albums $MUSICHOME/Singles -type f -iname "* - *$arg*.mp3"
		done
	) | sort -u
}

for track in $(get_tracks "$@")
do
	if [[ $verbose -eq 1 ]]
	then
		echo "$track"
	else
		base=$(basename "$track")
		dir=$(basename "$(dirname "$track")")
		echo "$dir/$base"
	fi
done
