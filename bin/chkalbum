#! /usr/bin/env perl

use myperl;
use autodie;


my $trackfile = file(shift);
my $album = $trackfile->basename;
$album =~ s/\.m3u$//;

# stupid shell quoting ...
my $arg = "$trackfile";
$arg =~ s/'/'"'"'/g;

say "$album:";
open(IN, "file -f '$arg' |");
while ( <IN> )
{
	next if /^#/;
	my ($track, $file) = m{ ^ (.*?) \.mp3: \s* (.*) $}x or die("unknown line: $_");
	($track = file($track)->basename) =~ s/^.*? - //;
	given ($file)
	{
		$file = "Confused" when /^Audio file/ and not /MPEG/;
		$file = "Good" when /^Audio file/;
		$file = "MISSING!" when /^cannot open/;
	}
	printf("  %-50s   %s\n", $track, $file);
}
close(IN);
